pipeline {  
    agent any
    environment {
    inputNhanh = ""
    inputType = ""
    }
    stages {
         stage('input OTWS') {
            steps {
                script {
                //def inputNhanh
                //def inputType
                def userInput = input( id: 'userInput', message: 'Chon nhanh OTWS can restart:?', 
                 parameters: [
                    //string(defaultValue: 'None', description: 'Nhanh can restart', name: 'Nhanh'),
                    choice(name: 'Nhanh', choices: ['0', '1','2','3','4','5','all'], description: 'Nhanh can restart'),
                    choice(name: 'Type', choices: ['0', '1', 'all'], description: 'chọn OTWS cần restart') 
                ])
                
                //env.inputNhanh = userInput.Nhanh?:''
                //env.inputType = userInput.Type?:''
                //echo("iput:   ${userInput}")
                echo ("Nhanh OTWS restart:" + userInput.Nhanh)
                echo ("Loai OTWS restart: " + userInput.Type) 
             
                    }
                }
            }
         stage('Show input values') {
                environment {
                                inputNhanh = ${userInput.Nhanh}
                                inputType = ${userInput.Type}
                            }
                steps {
                    echo "inputNhanh: ${inputNhanh}"
                    echo "inputType: ${inputType}"
                }
                }   
         stage('restart OTWS nhanh 5') {
                    when {
                        allOf {
                             expression { inputNhanh == '5' }
                             expression { inputType == '1' }
                            }
                        }
                    steps{
                            sh 'echo "restart OTWS nhanh 5" ' 
                        }
             }

         stage('restart OTWS1 nhanh 5') {               
                    when {
                        allOf {
                            expression { env.inputNhanh == '5' }
                            expression { env.inputType == '1' }
                            }
                        }
                    steps{
                            sh 'echo "restart OTWS1 nhanh 5" ' 
                        }
            }
            stage('restart all OTWS nhanh 5') {  
                    when {
                        allOf {
                            expression { env.inputNhanh == '5' }
                            expression { env.inputType == 'all' }
                            }
                        }
                    steps{
                            sh 'echo "restart OTWS nhanh 5" '  
                            sh 'echo "restart OTWS1 nhanh 5" '  
                        }
             }
            
          
            
             
                //  else{
                //      sh' echo "Lua chon khong hop le."'
                //       }
                           
                    // stage('check healthcheck after restart OTWS'){
                    //     steps{
                    //         timeout(time:2, unit: 'MINUTES') 
                    //         sh 'ansible-playbook /home/ansible/healthcheck0.yml' 
                    //             }
                    //         }
             }
        }