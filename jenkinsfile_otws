pipeline {  
    agent any    
    parameters: {
           //string(defaultValue: 'None', description: 'Nhanh can restart', name: 'Nhanh'),
            choice(name: 'Nhanh', choices: ['0', '1','2','3','4','5','all'], description: 'Nhanh can restart')
            choice(name: 'Type', choices: ['0', '1', 'all'], description: 'chọn OTWS cần restart') 
      }
    stages {
         stage('input OTWS') {
            steps {
                script {     
                def inputNhanh= params.Nhanh
                def inputType= params.Type
                echo ("Nhanh OTWS restart: ${inputNhanh}")
                echo ("Loai OTWS restart: ${inputType}") 
                    }
                }
            }
            
         stage('restart OTWS nhanh 5') {
                    when {
                        allOf {
                            expression {
                                params.Nhanh=='5' }
                            expression { 
                                params.Type == '0'}
                            }
                        }
                    steps{
                            sh 'ansible-playbook /home/ansible/recycleOTWS.yml' 
                        }
             }

         stage('restart OTWS1 nhanh 5') {               
                    when {
                        allOf {
                            expression {
                                params.Nhanh=='5' }
                            expression { 
                                params.Type == '1'}
                            }
                        }
                    steps{
                            sh 'ansible-playbook /home/ansible/recycleOTWS1.yml' 
                        }
            }
            stage('restart all OTWS nhanh 5') {  
                    when {
                        allOf {
                            expression {
                                params.Nhanh=='5' }
                            expression { 
                                params.Type == 'all'}
                            }
                        }
                    steps{
                            sh 'ansible-playbook /home/ansible/recycleOTWS.yml' 
                            sh 'ansible-playbook /home/ansible/recycleOTWS1.yml' 
                        }
             }
            
          
            
             
                //  else{
                //      sh' echo "Lua chon khong hop le."'
                //       }
                           
                    // stage('check healthcheck after restart OTWS'){
                    //     steps{
                    //         timeout(time:2, unit: 'MINUTES') 
                    //         sh 'ansible-playbook /home/ansible/healthcheck0.yml' 
                    //             }
                    //         }
             }
        }
 