pipeline {
    agent any
    stages {
            stage('input OTWS') {
                environment {
                    inputNhanh = ''
                    inputType = ''
                }
                steps {
                    script {

                    def userInput = input( id: 'userInput', message: 'Chon nhanh OTWS can restart:?',
                    parameters: [
                        //string(defaultValue: 'None', description: 'Nhanh can restart', name: 'Nhanh'),
                        choice(name: 'Nhanh', choices: ['0', '1','2','3','4','5','all'], description: 'Nhanh can restart'),
                        choice(name: 'Type', choices: ['0', '1', 'all'], description: 'chọn OTWS cần restart')
                    ])

                    echo ("Nhanh OTWS restart:" + userInput.Nhanh)
                    echo ("Loai OTWS restart: " + userInput.Type)
                    inputNhanh = userInput.Nhanh ?: ''
                    inputType= userInput.Type ?: ''
                    echo ("env Nhanh OTWS restart: ${inputNhanh}" )
                    echo ("env Loai OTWS restart: ${ inputType}" )
                    }
                    }
                }

            stage('Show input values') {
                    steps {

                        echo ("inputNhanh: ${inputNhanh}")
                        echo ("inputtype: ${ inputType}" )
                    }
            }
            stage('restart OTWS nhanh 5') {
                        when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == '0' }
                            }
                        }
                        steps{
                                sh 'ansible-playbook /home/ansible/5recycleOTWS.yml'
                        }
            }

            stage('restart OTWS1 nhanh 5') {
                        when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == '1' }
                            }
                        }
                        steps{
                                sh 'ansible-playbook /home/ansible/5recycleOTWS1.yml'
                        }
            }
                stage('restart all OTWS nhanh 5') {
                        when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == 'all' }
                            }
                        }
                        steps{
                                sh 'ansible-playbook /home/ansible/5recycleOTWS.yml '
                                sh 'ansible-playbook /home/ansible/5recycleOTWS1.yml '
                        }
                }
                stage('check healthcheck after restart OTWS'){
                    when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == '0' }
                                }
                            }
                    steps{
                            script {
                                echo "Waiting for 1 minutes..."
                                sleep time: 60, unit: 'SECONDS'
                            }
                            sh 'ansible-playbook /home/ansible/5healthcheck0.yml' 
                                 }
                          }    
                stage('check healthcheck after restart OTWS1'){
                        when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == '1' }
                                }
                            }
                        steps{
                            script {
                                echo "Waiting for 1 minutes..."
                                sleep time: 60, unit: 'SECONDS'
                            }
                            sh 'ansible-playbook /home/ansible/5healthcheck1.yml' 
                                 }
                          }
                    stage('check healthcheck after restart OTWS và OTWS1'){
                        when {
                            allOf {
                                expression { inputNhanh == '5' }
                                expression { inputType == '1' }
                                }
                            }
                        steps{
                            script {
                                echo "Waiting for 1 minutes..."
                                sleep time: 60, unit: 'SECONDS'
                            }
                            sh 'ansible-playbook /home/ansible/5healthcheck0.yml' 
                            sh 'ansible-playbook /home/ansible/5healthcheck1.yml' 
                                 }
                          }
            }
    }